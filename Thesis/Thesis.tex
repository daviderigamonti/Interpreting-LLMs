% A LaTeX template for MSc Thesis submissions to 
% Politecnico di Milano (PoliMi) - School of Industrial and Information Engineering
%
% S. Bonetti, A. Gruttadauria, G. Mescolini, A. Zingaro
% e-mail: template-tesi-ingind@polimi.it
%
% Last Revision: October 2021
%
% Copyright 2021 Politecnico di Milano, Italy. NC-BY

\documentclass{Configuration_Files/PoliMi3i_thesis}

%------------------------------------------------------------------------------
%	REQUIRED PACKAGES AND  CONFIGURATIONS
%------------------------------------------------------------------------------

% CONFIGURATIONS
\usepackage{parskip} % For paragraph layout
\usepackage{setspace} % For using single or double spacing
\usepackage{emptypage} % To insert empty pages
\usepackage{multicol} % To write in multiple columns (executive summary)
\setlength\columnsep{15pt} % Column separation in executive summary
\setlength\parindent{0pt} % Indentation
\raggedbottom

% PACKAGES FOR TITLES
\usepackage{titlesec}
% \titlespacing{\section}{left spacing}{before spacing}{after spacing}
\titlespacing{\section}{0pt}{3.3ex}{2ex}
\titlespacing{\subsection}{0pt}{3.3ex}{1.65ex}
\titlespacing{\subsubsection}{0pt}{3.3ex}{1ex}
\usepackage{color}

% PACKAGES FOR LANGUAGE AND FONT
\usepackage[english]{babel} % The document is in English  
\usepackage[utf8]{inputenc} % UTF8 encoding
\usepackage[T1]{fontenc} % Font encoding
\usepackage[11pt]{moresize} % Big fonts

% PACKAGES FOR IMAGES
\usepackage{graphicx}
\usepackage{transparent} % Enables transparent images
\usepackage{eso-pic} % For the background picture on the title page
\usepackage{subfig} % Numbered and caption subfigures using \subfloat.
\usepackage{tikz} % A package for high-quality hand-made figures.
\usetikzlibrary{}
\graphicspath{{./Images/}{./Images/Template/}{./Images/TikZ/img/}} % Directory of the images
\usepackage{caption} % Coloured captions
\usepackage{xcolor} % Coloured captions
\usepackage{amsthm,thmtools,xcolor} % Coloured "Theorem"
\usepackage{float}

% STANDARD MATH PACKAGES
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{bm}
\usepackage[overload]{empheq} % For braced-style systems of equations.
\usepackage{fix-cm} % To override original LaTeX restrictions on sizes

% PACKAGES FOR TABLES
\usepackage{tabularx}
\usepackage{longtable} % Tables that can span several pages
\usepackage{colortbl}

% PACKAGES FOR ALGORITHMS (PSEUDO-CODE)
\usepackage{algorithm}
\usepackage{algorithmic}

% PACKAGES FOR REFERENCES & BIBLIOGRAPHY
\usepackage[colorlinks=true,linkcolor=black,anchorcolor=black,citecolor=black,filecolor=black,menucolor=black,runcolor=black,urlcolor=black]{hyperref} % Adds clickable links at references
\usepackage{cleveref}
\usepackage[square, numbers, sort&compress]{natbib} % Square brackets, citing references with numbers, citations sorted by appearance in the text and compressed
\bibliographystyle{abbrvnat} % You may use a different style adapted to your field

% OTHER PACKAGES
\usepackage{pdfpages} % To include a pdf file
\usepackage{afterpage}
\usepackage{lipsum} % DUMMY PACKAGE
\usepackage{fancyhdr} % For the headers
\fancyhf{}

% Input of configuration file. Do not change config.tex file unless you really know what you are doing. 
\input{Configuration_Files/config}

%----------------------------------------------------------------------------
%	NEW COMMANDS DEFINED
%----------------------------------------------------------------------------

% EXAMPLES OF NEW COMMANDS
\newcommand{\bea}{\begin{eqnarray}} % Shortcut for equation arrays
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\e}[1]{\times 10^{#1}}  % Powers of 10 notation

%----------------------------------------------------------------------------
%	ADD YOUR PACKAGES (be careful of package interaction)
%----------------------------------------------------------------------------

\usepackage[threshold=1, thresholdtype=words]{csquotes}
\usepackage{booktabs}
\usepackage{cleveref}
\usepackage{dsfont}
\usepackage[export]{adjustbox}
\usepackage{makecell}
\usepackage{multirow}
\usepackage{hhline}
\usepackage{CJKutf8}
\usepackage{microtype}

% TODO: REMOVE after draft
\usepackage{soul}
\usepackage{todonotes}

%----------------------------------------------------------------------------
%	ADD YOUR DEFINITIONS AND COMMANDS (be careful of existing commands)
%----------------------------------------------------------------------------

\newcommand{\gbm}[1]{\bm{\mathbf{#1}}} % General Bold Math for both greek and latin letters

\renewcommand\mkblockquote[4]{\leavevmode\llap{``}\textit{#1#2#3}''#4} % Blockquote quotation marks
\renewcommand{\T}{\mathrm{T}} % Transpose

\setlength{\jot}{12pt} % Vertical equation spacing

\newcommand{\rowcolorhang}[1]{\rowcolor{#1}[\dimexpr\tabcolsep+0.1pt\relax]} % Add overang to table row coloring, to avoid vertical white lines

% TODO: REMOVE after draft
\renewcommand{\todo}[2][yellow]{\sethlcolor{#1}\hl{#2}} % TODO highlight

%----------------------------------------------------------------------------
%	BEGIN OF YOUR DOCUMENT
%----------------------------------------------------------------------------

\begin{document}

\fancypagestyle{plain}{%
\fancyhf{} % Clear all header and footer fields
\fancyhead[RO,RE]{\thepage} %RO=right odd, RE=right even
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}}

%----------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------

\pagestyle{empty} % No page numbers
\frontmatter % Use roman page numbering style (i, ii, iii, iv...) for the preamble pages

\puttitle{
	title={Interpreting Large Language \linebreak Models Through the Lens of \linebreak Embedding-Oriented \mbox{Visualizations}: \linebreak Markov Models, Sankey Diagrams and Comparative Approaches}, % Title of the thesis
	name=Davide Rigamonti, % Author Name and Surname
	course=Computer Science and Engineering \\ Ingegneria Informatica, % Study Programme (in Italian)
	ID=103152,  % Student ID number (numero di matricola)
	advisor=Prof. Mark Carman, % Supervisor name
	coadvisor={Nicolò Brunello, Vincenzo Scotti}, % Co-Supervisor name, remove this line if there is none
	academicyear={2024-25},  % Academic Year
} % These info will be put into your Title page 

%----------------------------------------------------------------------------
%	PREAMBLE PAGES: ABSTRACT (inglese e italiano), EXECUTIVE SUMMARY
%----------------------------------------------------------------------------
\startpreamble
\setcounter{page}{1} % Set page counter to 1

% ABSTRACT IN ENGLISH
\chapter*{Abstract} 
In recent years, the progress and widespread usage of Large Language Models (LLMs) has steadily increased.
Understanding the internal mechanisms of these complex and opaque engineering products poses an extremely relevant and critical challenge in the field of Natural Language Processing (NLP).
The NLP interpretability subfield aims to provide insights into the inner workings of language models (LMs).
This thesis presents InTraVisTo, an interactive visualization tool designed to provide an immediate and intuitive perspective on the generation process of LLMs by decoding their internal states, normally incomprehensible by humans, using tokens from their vocabularies.
InTraVisTo is implemented as an interactive framework that enables tracking of the flow of information through residual connections between model components, and it allows users to directly sway the model's predictions by modifying internal representations.
Additionally, this research investigates whether recent LLMs retain linear properties in their embedding spaces through the established semantic analysis framework of word analogies, finding that current state-of-the art LLMs are capable of encoding a surprising amount of semantic relationships within their embeddings.
Furthermore, this work examines the feasibility of obtaining first-order predictions by concatenating input and output embeddings in large-scale models, testing whether LLMs inherently approximate a Markov model structure.
Our findings demonstrate that first-order models (FOMs) extracted from LLMs exhibit a clear bias towards modeling a Markovian behavior, despite significant differences in accuracy across model architectures.
Overall, this thesis confirms previous findings on new architectures and introduces a robust tool aimed at making LLMs more transparent and accessible to researchers in the NLP field.
\\
\\
\textbf{Keywords:} AI, NLP, Interpretabilty, Word Embedding, LLM

% ABSTRACT IN ITALIAN
\chapter*{Abstract in lingua italiana}
Negli ultimi anni, lo sviluppo e la diffusione su larga scala dei Large Language Models (LLMs) hanno registrato un costante incremento.
Comprendere i meccanismi interni di simili prodotti ingegneristici di natura complessa e opaca costituisce una sfida di rilevanza e importanza critica nel campo dell'Elaborazione del Linguaggio Naturale (NLP), di conseguenza il sottocampo dell'interpretabilità nell'ambito dell'NLP si propone di fornire una comprensione approfondita del funzionamento interno dei modelli linguistici (LMs).
In questa tesi si presenta InTraVisTo, uno strumento di visualizzazione interattiva concepito per offrire una prospettiva intuitiva ed immediata sul processo generativo svolto dagli LLM mediante la decodifica dei loro stati interni, altrimenti umanamente incomprensibili, attraverso l'impiego dei token presenti nel relativo vocabolario.
InTraVisTo è implementato in qualità di framework di natura interattiva, che consente di monitorare il flusso informativo attraverso connessioni residue tra i vari componenti del modello e permette agli utenti di intervenire influenzando direttamente le previsioni modificando le rappresentazioni interne appartenenti al modello.
Inoltre, in questa ricerca vengono analizzati gli LLM più recenti al fine di verificare se conservino le proprietà lineari all'interno dei rispettivi spazi di embedding, adoperando il consolidato framework di analisi semantica basato sulle analogie tra parole, evidenziando come i modelli di ultima generazione siano capaci di codificare un sorprendente numero di relazioni semantiche nei loro embedding.
In aggiunta, questo lavoro esamina le possibilità di ottenere previsioni di primo ordine attraverso la concatenazione degli embedding di input e output su modelli di larga scala, verificando se gli LLM approssimino intrinsecamente la struttura di un modello di Markov.
I risultati ottenuti evidenziano che i modelli di primo ordine (FOM) derivati dagli LLM manifestano una chiara propensione verso un comportamento Markoviano, sebbene emergano significative differenze di accuratezza in funzione delle architetture adottate.
In sintesi, la presente tesi conferma risultati storici su nuove architetture e introduce un robusto strumento finalizzato a rendere gli LLM maggiormente trasparenti e accessibili alla comunità di ricerca nel campo dell'NLP.
\\
\\
\textbf{Parole chiave:} AI, NLP, Interpretabilità, Word Embedding, LLM

%----------------------------------------------------------------------------
%	LIST OF CONTENTS/FIGURES/TABLES/SYMBOLS
%----------------------------------------------------------------------------

% TABLE OF CONTENTS
\thispagestyle{empty}
\tableofcontents % Table of contents 
\thispagestyle{empty}
\cleardoublepage

%-------------------------------------------------------------------------
%	THESIS MAIN TEXT
%-------------------------------------------------------------------------
% In the main text of your thesis you can write the chapters in two different ways:
%
%(1) As presented in this template you can write:
%    \chapter{Title of the chapter}
%    *body of the chapter*
%
%(2) You can write your chapter in a separated .tex file and then include it in the main file with the following command:
%    \chapter{Title of the chapter}
%    \input{chapter_file.tex}
%
% Especially for long thesis, we recommend you the second option.

\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics
\mainmatter % Begin numeric (1,2,3...) page numbering

\chapter{Background and motivations}\label{ch:background}
\input{Chapters/1_Background.tex}

\chapter{Related works}\label{ch:related_works}
\input{Chapters/2_Related_Works.tex}

\chapter{Research questions}\label{ch:research_questions}
\input{Chapters/3_Research_Questions.tex}

\chapter{Methodology}\label{ch:methodology}
\input{Chapters/4_Methodology.tex}

\chapter{Experiments}\label{ch:experiments}
\input{Chapters/5_Experiments.tex}

\chapter{Conclusions and future developments}\label{ch:conclusions}
\input{Chapters/6_Conclusions.tex}

%-------------------------------------------------------------------------
%	BIBLIOGRAPHY
%-------------------------------------------------------------------------

\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics
\bibliography{Thesis_bibliography} % The references information are stored in the file named "Thesis_bibliography.bib"

%-------------------------------------------------------------------------
%	APPENDICES
%-------------------------------------------------------------------------

\cleardoublepage
\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics
\appendix
\chapter{Appendix A}
If you need to include an appendix to support the research in your thesis, you can place it at the end of the manuscript.
An appendix contains supplementary material (figures, tables, data, codes, mathematical proofs, surveys, \dots)
which supplement the main results contained in the previous chapters.

\chapter{Appendix B}
It may be necessary to include another appendix to better organize the presentation of supplementary material.


% LIST OF FIGURES
\listoffigures

% LIST OF TABLES
\listoftables

% LIST OF SYMBOLS
% Write out the List of Symbols in this page
\chapter*{List of Symbols} % You have to include a chapter for your list of symbols (
\begin{table}[H]
    \centering
    \begin{tabular}{lll}
        \textbf{Variable} & \textbf{Description} & \textbf{SI unit} \\
		\midrule \\[-9px]
        $\bm{u}$ & solid displacement & m \\[2px]
        $\bm{u}_f$ & fluid displacement & m \\[2px]
    \end{tabular}
\end{table}

% ACKNOWLEDGEMENTS
\chapter*{Acknowledgements}
Here you might want to acknowledge someone.

\cleardoublepage

\end{document}
